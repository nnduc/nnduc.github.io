<!DOCTYPE html>





<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">
  <link rel="alternate" href="/atom.xml" title="Duc Ninja" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","display":"always","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="As one of the most powerful features in Swift, Generics can be tricky. A lot of people have trouble understanding and using them, especially application developers. Generics are most suitable for lib">
<meta name="keywords" content="tips,swift">
<meta property="og:type" content="article">
<meta property="og:title" content="Generics in Swift 4">
<meta property="og:url" content="https://duc.ninja/2017/09/272017/generics-in-swift-4/index.html">
<meta property="og:site_name" content="Duc Ninja">
<meta property="og:description" content="As one of the most powerful features in Swift, Generics can be tricky. A lot of people have trouble understanding and using them, especially application developers. Generics are most suitable for lib">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://duc.ninja/assets/images/swift-generics.png">
<meta property="og:updated_time" content="2019-11-26T09:14:50.866Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Generics in Swift 4">
<meta name="twitter:description" content="As one of the most powerful features in Swift, Generics can be tricky. A lot of people have trouble understanding and using them, especially application developers. Generics are most suitable for lib">
<meta name="twitter:image" content="https://duc.ninja/assets/images/swift-generics.png">
  <link rel="canonical" href="https://duc.ninja/2017/09/272017/generics-in-swift-4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Generics in Swift 4 | Duc Ninja</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Duc Ninja</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">I'm an iOS engineer and a ninja as well.</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
        
        
        <li class="menu-item menu-item-blog">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-home"></i>Blog</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-my-info">
      
    

    <a href="https://linkedin.com/in/nnduc" rel="noopener" target="_blank"><i class="fa fa-fw fa-user"></i>My info</a>

  </li>
      
    
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="https://duc.ninja/2017/09/272017/generics-in-swift-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Duc Ninja">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/images/logo/icon-310x310.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Duc Ninja">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            Generics in Swift 4
            

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2017-09-27 15:11:34" itemprop="dateCreated datePublished" datetime="2017-09-27T15:11:34+07:00">2017-09-27</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-26 16:14:50" itemprop="dateModified" datetime="2019-11-26T16:14:50+07:00">2019-11-26</time>
              </span>
            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="/assets/images/swift-generics.png" alt></p>
<p>As one of the most powerful features in Swift, Generics can be tricky. A lot of people have trouble understanding and using them, especially application developers. Generics are most suitable for libraries, frameworks, and SDKs. In this post, I’ll try something different than other tutorials. We’ll open a restaurant and get a permission from SwiftyCity City Council. For the sake of integrity, I’ll try to keep things under four subjects.</p>
<a id="more"></a>
<ol>
<li>Generic Functions and Generic Types</li>
<li>Protocols with Associated Types</li>
<li>Generic Where Clauses</li>
<li>Generic Subscripts</li>
</ol>
<p><br>Here we go! <br></p>
<h2 id="Generic-Functions-and-Generic-Types"><a href="#Generic-Functions-and-Generic-Types" class="headerlink" title="Generic Functions and Generic Types"></a>Generic Functions and Generic Types</h2><h4 id="Opening-a-Swift-Restaurant"><a href="#Opening-a-Swift-Restaurant" class="headerlink" title="Opening a Swift Restaurant"></a>Opening a Swift Restaurant</h4><p>Let’s set up a new restaurant. While setting up, instead of focusing only our restaurant construction, we’ll also take a look at the legal part, the city council’s permission. Furthermore, we will focus on our own business to make it functional and profitable.<br>First, how does a company look like to The Council? A company should have some basic functionalities.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Company</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">buy</span><span class="params">(product: Product, money: Money)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">sell</span><span class="params">(product: Product.<span class="keyword">Type</span>, money: Money)</span></span> -&gt; <span class="type">Product?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>buy function adds the product to the inventory and it takes money out of company’s vault. On the other hand, sell function gets the product type, creates/finds the product and returns it in exchange for the money.</p>
<h4 id="Generic-Functions"><a href="#Generic-Functions" class="headerlink" title="Generic Functions"></a>Generic Functions</h4><p>In this protocol, Product being in actual type doesn’t sound right. Fitting every real product into Product type is not possible. Each product has different functionalities, properties and so on. Using an actual type in these kinds of functions is a really bad idea. Let’s turn back to The Council. All in the world, whatever each company does, it requires having to buy and sell capability. So, The Council has to find a generic solution for these two functions and make them work for every company. They can improve these functions using Generics:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Company</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">buy</span>&lt;T&gt;<span class="params">(product: T, with money: Money)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">sell</span>&lt;T&gt;<span class="params">(product: T.<span class="keyword">Type</span>, <span class="keyword">for</span> money: Money)</span></span> -&gt; <span class="type">T?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So, we replaced our actual type Product with placeholder type T. The type parameter <t> defines these functions as generics. Placeholder types are replaced with actual types during compile time. So, the actual type will be determined whenever buy and sell functions used. This provides flexibility to use same functions for every product. For example, we’ll sell Penne Arrabiata in our Swift Restaurant. We can directly call sell function like following:</t></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> penneArrabiata = swiftRestaurant.sell(product: <span class="type">PenneArrabiata</span>.<span class="type">Self</span>, <span class="keyword">for</span>: <span class="type">Money</span>(value:<span class="number">7.0</span>, currency: .dollar))</span><br></pre></td></tr></table></figure>

<p>The compiler replaces T with PenneArrabiata‘s type during compilation time. When this method gets called in runtime, it will already have an actual type (PenneArrabiata) instead of a placeholder type. But there’s another problem. We can’t just buy and sell any type here, there needs to be something to define what we can legally buy and sell. This is where type constraints comes in. The Council has another protocol named LegallyTradable. It just checks and marks products that we can buy and sell legally. The Council forces us to apply this protocol to all trading operations. The Council will iterate over every product and adopt all suitable products to this protocol. So, we have to put type constraints to our generic functions to limit our functions’ usage for only allowed products.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Company</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">buy</span>&lt;T: LegallyTradable&gt;<span class="params">(product: T, with money: Money)</span></span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">sell</span>&lt;T: LegallyTradable&gt;<span class="params">(product: T.<span class="keyword">Type</span>, <span class="keyword">for</span> money: Money)</span></span> -&gt; <span class="type">T?</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now, we can use these functions with inner peace. Basically, we put a constraint on our placeholder type T with saying “Only products which conform to LegallyTradable can be parameters of our Company protocol’s functions”. This constraint is called protocol as a constraint in Swift. If one product is not conforming to this protocol, it can’t be used as a parameter in this function.</p>
<h4 id="Generic-Types"><a href="#Generic-Types" class="headerlink" title="Generic Types"></a>Generic Types</h4><p>Let’s move the focus to our restaurant. We got our permission and ready to focus on restaurant management. We hired a great manager and she wants to set up a system to keep track of every item in our inventory separately. In our restaurant, we have a wonderful pasta menu and our customers are going to love all kinds of pasta. That’s why we need a huge place to store pasta. We created a list of pasta packages and whenever chefs use a package, they remove it from the list. Also, whenever the restaurant buys a pasta package we’ll add it to our list. Lastly, our manager will order new packages if there are less than three packages in the list. Here is our PastaPackageList struct:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PastaPackageList</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> packages: [<span class="type">PastaPackage</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(package: PastaPackage)</span></span> &#123;</span><br><span class="line">    packages.append(item)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">PastaPackage</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> packages.removeLast()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">isCapacityLow</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> packages.<span class="built_in">count</span> &lt; <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After a while, our manager started to think that we will need to create a list for each item in the restaurant to track them better. Instead of creating separate list structures every time, generics can help us in here. If we define our inventory list as a generic type, we can easily create new inventory lists with using the same struct implementation. Same as the generic functions, type parameter <t> defines our struct as generic. So we just need to replace PastaPackage actual type with placeholder type T.</t></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">InventoryList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> items: [<span class="type">T</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(item: T)</span></span> &#123;</span><br><span class="line">    items.append(item)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">T</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> items.removeLast()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">isCapacityLow</span><span class="params">()</span></span> -&gt; <span class="type">Bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> items.<span class="built_in">count</span> &lt; <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This generic type gives us the ability to create separate inventory lists for each item in our inventory using the same implementation.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pastaInventory = <span class="type">InventoryList</span>&lt;<span class="type">PastaPackage</span>&gt;()</span><br><span class="line">pastaInventory.add(item: <span class="type">PastaPackage</span>())</span><br><span class="line"><span class="keyword">var</span> tomatoSauceInventory = <span class="type">InventoryList</span>&lt;<span class="type">TomatoSauce</span>&gt;()</span><br><span class="line"><span class="keyword">var</span> flourSackInventory = <span class="type">InventoryList</span>&lt;<span class="type">FlourSack</span>&gt;()</span><br></pre></td></tr></table></figure>

<p>Another advantage of generic types is that whenever our manager needs some extra information like the first item in our inventory, we can write extensions to add the functionality. Swift allows us to write an extension for structs, classes, and protocols. While extending the generic type, we don’t need to provide type parameter as we do when defining structs. Yet, we can still use placeholder type in the extension. Let’s implement our manager’s request to understand better.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">InventoryList</span> </span>&#123; <span class="comment">// We define it without any type parameters</span></span><br><span class="line">  <span class="keyword">var</span> topItem: <span class="type">T?</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> items.last</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>InventoryList‘s existing type parameter T is used to indicate the type of topItem without defining the type parameter again.<br>Now we have inventory lists for all products we have. We still don’t have a storage because every restaurant should apply to The Council for getting permission to store goods for long periods. So, let’s move our focus to The Council.</p>
<h4 id="Protocols-with-Associated-Types"><a href="#Protocols-with-Associated-Types" class="headerlink" title="Protocols with Associated Types"></a>Protocols with Associated Types</h4><p>We went to the city council again to get permission to store food. The Council stipulates some rules that we have to obey. For instance, every restaurant with storage should have their storage clean and put some certain foods away from each other. Also, The Council wants to check restaurants’ current inventory whenever they want. They provide a protocol which every store owner should conform. Again, this protocol cannot be specific to the restaurant. Because storage items can change for different types of shops and also for the restaurants. In Swift, generic protocols are implemented with associated types. Let’s have a look at the Storage protocol came from the city council.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Storage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Item</span></span><br><span class="line">  <span class="keyword">var</span> items: [<span class="type">Item</span>] &#123; <span class="keyword">set</span> <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(item: Item)</span></span></span><br><span class="line">  <span class="keyword">var</span> size: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">Item</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showCurrentInventory</span><span class="params">()</span></span> -&gt; [<span class="type">Item</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Storage protocol doesn’t specify how the items in the storage should be stored or what type they are allowed to be. Any shop, restaurant that conforms to Storage protocol must be able to specify the type of values it stores. It has to ensure that correct type of items are added to and removed from storage. Also, it has to be able to show current inventory completely. So, for our storage, we can conform Storage protocol like following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SwiftRestaurantStorage</span>: <span class="title">Storage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typealias</span> <span class="type">Item</span> = <span class="type">Food</span> <span class="comment">// Optional</span></span><br><span class="line">  <span class="keyword">var</span> items = [<span class="type">Food</span>]()</span><br><span class="line">  <span class="keyword">var</span> size: <span class="type">Int</span> &#123; <span class="keyword">return</span> <span class="number">100</span> &#125;</span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(item: Food)</span></span> &#123; ... &#125;</span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">Food</span> &#123; ... &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showCurrentInventory</span><span class="params">()</span></span> -&gt; [<span class="type">Food</span>] &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We conformed The Council’s Storage protocol. From now on, associated type Item is replaced with our Food type. Our restaurant’s storage is all available for Food. Associated type Item is just a placeholder type in protocols. We define the type with typealias keyword. But pointing out with this keyword is optional in Swift. Even if we don’t use typealias keyword it’ll still compile as long as we use our Food type in all places that Item uses in the protocol. Swift automatically handles this.</p>
<h4 id="Constraining-an-Associated-Type-with-Type-Annotation"><a href="#Constraining-an-Associated-Type-with-Type-Annotation" class="headerlink" title="Constraining an Associated Type with Type Annotation"></a>Constraining an Associated Type with Type Annotation</h4><p>Like in real life, The Council always comes up with new rules and force you to obey them. After a while, The Council modifies their Storage protocol. They announce that they won’t allow every item in the Storage. Every Item must conform to StorableItem protocol to be sure they are suitable for storage. In other words, they constrained the associated type Item.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Storage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Item</span>: <span class="type">StorableItem</span> <span class="comment">// Constrained associated type</span></span><br><span class="line">  <span class="keyword">var</span> items: [<span class="type">Item</span>] &#123; <span class="keyword">set</span> <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> size: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(item: Item)</span></span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">Item</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showCurrentInventory</span><span class="params">()</span></span> -&gt; [<span class="type">Item</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Using this method, The Council constrained the type for the current associated type. Anyone who conforms to Storage protocol now has to use type aliases which conform to StorableItem protocol.</p>
<h2 id="Generic-Where-Clauses"><a href="#Generic-Where-Clauses" class="headerlink" title="Generic Where Clauses"></a>Generic Where Clauses</h2><h4 id="Generic-Types-with-a-Generic-Where-Clause"><a href="#Generic-Types-with-a-Generic-Where-Clause" class="headerlink" title="Generic Types with a Generic Where Clause"></a>Generic Types with a Generic Where Clause</h4><p>Let’s go back to the beginning of the post and take a look at the Money type in our Company protocol. As we are all talking about protocols, money parameter of buy and sell functions was actually a protocol.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Money</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Currency</span></span><br><span class="line">  <span class="keyword">var</span> currency: <span class="type">Currency</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> amount: <span class="type">Float</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">sum</span>&lt;M: Money&gt;<span class="params">(with money: M)</span></span> -&gt; <span class="type">M</span> <span class="keyword">where</span> <span class="type">M</span>.<span class="type">Currency</span> == <span class="type">Currency</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Again, after a while, The Council hit back to us with saying that they decided to have another rule. From now on, trading is only allowed with some currencies. Before that, we could use every kind of money in the type of Money. Instead of defining new money type for every currency, they decided to use Money protocol and changed the buy and sell functions as follows.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Company</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">buy</span>&lt;T: LegallyTradable, M: Money&gt;<span class="params">(product: T.<span class="keyword">Type</span>, with money: M)</span></span> -&gt; <span class="type">T?</span> <span class="keyword">where</span> <span class="type">Money</span>.<span class="type">Currency</span>: <span class="type">TradeCurrency</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">sell</span>&lt;T: LegallyTradable, M: Money&gt;<span class="params">(product: T, <span class="keyword">for</span> money: M)</span></span> <span class="keyword">where</span> <span class="type">Money</span>.<span class="type">Currency</span>: <span class="type">TradeCurrency</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The difference between where clause and type constraint is where clauses are used to define requirements in associated type. In other words, we are not constraining the associated type inside the protocol. Instead, we’re constraining it while using the protocol.</p>
<h4 id="Extension-with-a-Generic-Where-Clause"><a href="#Extension-with-a-Generic-Where-Clause" class="headerlink" title="Extension with a Generic Where Clause"></a>Extension with a Generic Where Clause</h4><p>Other usages of where clauses are in extensions. For instance, when The Council needs to print the money in a good format like “xxx EUR”, they can add an extension to Money with limiting its Currency to Euro</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Money</span> <span class="title">where</span> <span class="title">Currency</span> == <span class="title">Euro</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">printAmount</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\(amount) EUR"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Generic where clause lets us add a new requirement to Money extension so that the extension adds the printAmount() method only when the Currency is Euro.</p>
<p>Associated Types with a Generic Where Clause</p>
<p>Our beloved council makes some improvements in Storage protocol. They want to iterate over each item and control them when they want to inspect if everything is OK. Controlling process is going to be different for each Item. Because of that, the council just provides iteration feature for Storage by adding an Iterator associated type.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">protocol</span> <span class="title">Storage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Item</span>: <span class="type">StorableItem</span></span><br><span class="line">  <span class="keyword">var</span> items: [<span class="type">Item</span>] &#123; <span class="keyword">set</span> <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> size: <span class="type">Int</span> &#123; <span class="keyword">get</span> &#125;</span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(item: Item)</span></span></span><br><span class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">remove</span><span class="params">()</span></span> -&gt; <span class="type">Item</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">showCurrentInventory</span><span class="params">()</span></span> -&gt; [<span class="type">Item</span>]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">associatedtype</span> <span class="type">Iterator</span>: <span class="type">IteratorProtocol</span> <span class="keyword">where</span> <span class="type">Iterator</span>.<span class="type">Element</span> == <span class="type">Item</span></span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">makeIterator</span><span class="params">()</span></span> -&gt; <span class="type">Iterator</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Iterator protocol has associated type named Element and in here we add a requirement with saying the type of Element must be equal to the type of Item in the Storage protocol.</p>
<h2 id="Generic-Subscripts"><a href="#Generic-Subscripts" class="headerlink" title="Generic Subscripts"></a>Generic Subscripts</h2><p>It seems like requests from manager and council are endless. Also, we’re here to materialize their wishes. So, our manager came to us with saying that she wants to access storage items using a Sequence without accessing all items. Basically, the manager wants a syntax sugar.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Storage</span> </span>&#123;</span><br><span class="line">  <span class="keyword">subscript</span>&lt;<span class="type">Indices</span>: <span class="type">Sequence</span>&gt;(<span class="built_in">indices</span>: <span class="type">Indices</span>) -&gt; [<span class="type">Item</span>] <span class="keyword">where</span> <span class="type">Indices</span>.<span class="type">Iterator</span>.<span class="type">Element</span> == <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result = [<span class="type">Item</span>]()</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">indices</span> &#123;</span><br><span class="line">      result.append(<span class="keyword">self</span>.items[index])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In Swift 4, subscripts can be generic and we can use generic where clauses. In our usage, indices parameter has to conform Sequence protocol. From Apple doc, “The generic where clause requires that the iterator for the sequence must traverse over elements of type Int.” This ensures that the indices in the sequence are the same type as the indices used in storage.</p>
<p>Source: <a href="https://theswiftpost.co/generics-swift-4/" target="_blank" rel="noopener">theswiftpost.co</a></p>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/tips/" rel="tag"># tips</a>
            
              <a href="/tags/swift/" rel="tag"># swift</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2017/09/262017/macos-high-sierra-final-version-for-your-mac/" rel="next" title="macOS High Sierra Final Version for Your Mac">
                  <i class="fa fa-chevron-left"></i> macOS High Sierra Final Version for Your Mac
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2017/10/012017/measuring-swift-compile-times-in-xcode-9/" rel="prev" title="Measuring Swift Compile Times in Xcode 9">
                  Measuring Swift Compile Times in Xcode 9 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Generic-Functions-and-Generic-Types"><span class="nav-number">1.</span> <span class="nav-text">Generic Functions and Generic Types</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Opening-a-Swift-Restaurant"><span class="nav-number">1.0.1.</span> <span class="nav-text">Opening a Swift Restaurant</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Generic-Functions"><span class="nav-number">1.0.2.</span> <span class="nav-text">Generic Functions</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Generic-Types"><span class="nav-number">1.0.3.</span> <span class="nav-text">Generic Types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Protocols-with-Associated-Types"><span class="nav-number">1.0.4.</span> <span class="nav-text">Protocols with Associated Types</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Constraining-an-Associated-Type-with-Type-Annotation"><span class="nav-number">1.0.5.</span> <span class="nav-text">Constraining an Associated Type with Type Annotation</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generic-Where-Clauses"><span class="nav-number">2.</span> <span class="nav-text">Generic Where Clauses</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Generic-Types-with-a-Generic-Where-Clause"><span class="nav-number">2.0.1.</span> <span class="nav-text">Generic Types with a Generic Where Clause</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Extension-with-a-Generic-Where-Clause"><span class="nav-number">2.0.2.</span> <span class="nav-text">Extension with a Generic Where Clause</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generic-Subscripts"><span class="nav-number">3.</span> <span class="nav-text">Generic Subscripts</span></a></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/assets/images/logo/icon-310x310.png"
      alt="Duc Ninja">
  <p class="site-author-name" itemprop="name">Duc Ninja</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives">
        
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://github.com/ducito" title="GitHub &rarr; https://github.com/ducito" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="mailto:nnduc@icloud.com" title="E-Mail &rarr; mailto:nnduc@icloud.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://twitter.com/duc_ninja" title="Twitter &rarr; https://twitter.com/duc_ninja" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="https://www.facebook.com/duc.ninja" title="FB Page &rarr; https://www.facebook.com/duc.ninja" rel="noopener" target="_blank"><i class="fa fa-fw fa-facebook"></i></a>
      </span>
    
      <span class="links-of-author-item">
      
      
      
        
      
        <a href="skype:ducnn01?call|chat" title="Skype &rarr; skype:ducnn01?call|chat" rel="noopener" target="_blank"><i class="fa fa-fw fa-skype"></i></a>
      </span>
    
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Duc Ninja</span>
</div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/muse.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  

  

</body>
</html>

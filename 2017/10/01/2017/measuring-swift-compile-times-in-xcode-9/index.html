<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Measuring Swift compile times in Xcode 9 · Duc Ninja</title><meta name="description" content="Measuring Swift compile times in Xcode 9 - Duc Ninja"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://duc.ninja/atom.xml" title="Duc Ninja"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://twitter.com/duccuimia" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/ducito" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Measuring Swift compile times in Xcode 9</h1><div class="post-info">Oct 1, 2017</div><div class="post-content"><h2 id="Using-Xfrontend-Swift-compiler-flags"><a href="#Using-Xfrontend-Swift-compiler-flags" class="headerlink" title="Using -Xfrontend Swift compiler flags"></a>Using -Xfrontend Swift compiler flags</h2><p>The Swift type-checker remains <a href="https://www.cocoawithlove.com/blog/2016/07/12/type-checker-issues.html" target="_blank" rel="noopener">a performance bottleneck</a> for compile times, though it has <a href="https://github.com/apple/swift/search?utf8=%E2%9C%93&amp;q=type+checker+improve&amp;type=Commits" target="_blank" rel="noopener">improved</a><a href="https://github.com/apple/swift/search?utf8=%E2%9C%93&amp;q=type+checker+performance&amp;type=Commits" target="_blank" rel="noopener">tremendously</a> over the past two years. You could even say the type-checker has gone from being <a href="https://spin.atomicobject.com/2016/04/26/swift-long-compile-time/" target="_blank" rel="noopener">drunk</a> to <a href="https://github.com/apple/swift/commit/2cdd7d64e1e2add7bcfd5452d36e7f5fc6c86a03" target="_blank" rel="noopener">sober</a>. To help users debug these issues, awhile back <a href="https://github.com/apple/swift/commit/18c75928639acf0ccf0e1fb6729eea75bc09cbd5" target="_blank" rel="noopener">Jordan Rose added</a> a frontend Swift compiler flag that would emit warnings in Xcode for functions that took too long to compile, or rather took too long to type-check. In Xcode 9, there’s a new, similar flag for checking expressions.</p>
<h3 id="About-warn-long-function-bodies"><a href="#About-warn-long-function-bodies" class="headerlink" title="About -warn-long-function-bodies"></a>About <code>-warn-long-function-bodies</code></h3><p><a href="http://irace.me/swift-profiling" target="_blank" rel="noopener">Bryan Irace</a> and <a href="http://khanlou.com/2016/12/guarding-against-long-compiles/" target="_blank" rel="noopener">Soroush Khanlou</a> originally wrote about the <code>-warn-long-function-bodies</code> flag when it was first introduced. You could specify a threshold in milliseconds that would trigger a warning. For example: <code>-Xfrontend -warn-long-function-bodies=100</code> would trigger a warning in Xcode for any function that took longer than 100ms to type-check. This was always considered an experimental flag, as Jordan notes in his original <a href="https://github.com/apple/swift/commit/18c75928639acf0ccf0e1fb6729eea75bc09cbd5" target="_blank" rel="noopener">commit</a>: <em>As a frontend option, this is UNSUPPORTED and may be removed without notice at any future date.</em> As far as I can tell, this is still the case. However, this flag still works in Xcode 9 and I haven’t seen any discussion about removing it.</p>
<h3 id="About-warn-long-expression-type-checking"><a href="#About-warn-long-expression-type-checking" class="headerlink" title="About -warn-long-expression-type-checking"></a>About <code>-warn-long-expression-type-checking</code></h3><p>In Xcode 9, there is a new, similar flag for type-checking expressions, not just functions. However, this time the flag made an appearance in the <em>official</em> Xcode 9 GM <a href="https://download.developer.apple.com/Developer_Tools/Xcode_9_GM_seed_build_9A235/Xcode_9_GM_seed_Release_Notes.pdf" target="_blank" rel="noopener">release notes</a>:</p>
<blockquote>
<p>The compiler can now warn about individual expressions that take a long time to type check.</p>
<p>To enable this warning, go the Build Settings, “Swift Compiler - Custom Flags”, “Other Swift Flags”, and add: <code>-Xfrontend -warn-long-expression-type-checking=&lt;limit&gt;</code> where <code>&lt;limit&gt;</code> is the lower limit of the number of milliseconds that an expression must take to type check in order for the warning to be emitted.</p>
<p>This allows users to identify those expressions that are contributing significantly to build times and rework them by splitting them up or adding type annotations to attempt to reduce the time spent on those expressions. (32619658)</p>
</blockquote>
<p>This time, you can thank <a href="https://github.com/apple/swift/pull/10214" target="_blank" rel="noopener">Mark Lacey</a> for the flag. (<a href="https://github.com/apple/swift/pull/10215" target="_blank" rel="noopener">pull request for Swift 4</a>)</p>
<h3 id="Using-these-flags-to-improve-compile-times"><a href="#Using-these-flags-to-improve-compile-times" class="headerlink" title="Using these flags to improve compile times"></a>Using these flags to improve compile times</h3><p>As mentioned, after you add these flags you will start getting warnings. Keep in mind that if the threshold is too low, for example 10ms, then you will get <strong>a ton</strong> of warnings that cannot be fixed. Experiment with these threshold values and adjust as needed. I suggest starting at <code>200</code> and tuning from there. If your code base is large, it might make more sense to use a higher value for your project (say <code>500</code>) and try to decrease it over time. Otherwise, you’ll be spending <strong>a lot</strong> of time trying to get all functions and expressions to compile in under 200ms. Also, I recommend setting these flags only for <code>DEBUG</code> build configurations.</p>
<p>There are two common scenarios where Xcode will start emitting warnings with these flags: (1) very complex expressions or functions, and (2) expressions that omit explicit types and rely on <a href="https://developer.apple.com/library/content/documentation/Swift/Conceptual/Swift_Programming_Language/Types.html" target="_blank" rel="noopener">type inference</a>. To silence the warnings — and thus improve compile times — try breaking up expressions into smaller steps with intermediate variables, and adding explicit types to variable declarations and closure parameters. The code may not look as elegant after these changes, but what’s more important to you and your team?</p>
<p><img src="/assets/images/xcode-front-end-flags.png" alt=""></p>
<h3 id="A-temporary-solution"><a href="#A-temporary-solution" class="headerlink" title="A temporary solution"></a>A temporary solution</h3><p>Using these flags is obviously a temporary (and kind of hacky) solution to improving compile times. It only treats the symptoms rather than the cause, but it is better than nothing. As I said before, the Swift team is well aware of the problems and they are working hard to address them. Every single Swift release is getting better and I’m sure Swift 5 will bring even more improvements.</p>
<p>I’m hoping using these flags — and having to change your code to improve compilation times — will soon be a hack of the past. Eventually it will be, we just don’t know when.</p>
<p>Source: [jessesquires.com][theswiftpost.co]</p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/10/22/2017/convert-utc-local-swift4/" class="prev">PREV</a><a href="/2017/09/27/2017/generics-in-swift-4/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2018 <a href="https://duc.ninja">Duc Ninja</a> , powered by <a href="https://twitter.com/duccuimia/" target="_blank">@duccuimia</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>